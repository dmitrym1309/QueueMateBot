# QueueMateBot

Телеграм-бот для управления очередями в групповых чатах.

## Описание

QueueMateBot позволяет создавать и управлять очередями в групповых чатах Telegram. Бот помогает организовать порядок выступлений, ответов на вопросы или любых других действий, требующих очереди.

## Функциональность

- Создание очередей (только администраторы)
- Присоединение к очереди
- Выход из очереди
- Просмотр списка очередей
- Просмотр участников конкретной очереди
- Удаление очередей (только администраторы)
- Установка отображаемого имени
- Удаление пользователей из очереди (только администраторы)
- Изменение позиции пользователя в очереди (только администраторы)
- Пропуск позиции (перемещение на одну позицию назад)

## Структура проекта

- `main.py` - основной файл для запуска бота
- `config.py` - конфигурация бота и базы данных
- `database.py` - работа с базой данных
- `handlers.py` - обработчики команд
- `qm_docs_build.py` - утилита для сборки документации
- `docs/` - исходные файлы документации в формате Markdown

## Установка и запуск

### Стандартный способ

1. Установите необходимые зависимости:
```
pip install -r requirements.txt
```

2. Настройте токен бота в файле `.env`

3. Запустите бота:
```
python main.py
```

### Использование Docker

Бот можно запустить с помощью Docker для более удобного развертывания:

1. Убедитесь, что у вас установлен [Docker](https://www.docker.com/products/docker-desktop/) и Docker Compose

2. Настройте токен бота в файле `.env`

3. Запустите бота с помощью Docker Compose:
```
docker-compose up -d
```

4. Для просмотра логов:
```
docker-compose logs -f
```

5. Для остановки бота:
```
docker-compose down
```

## Использование setuptools

Проект можно установить с помощью setuptools для более удобного управления:

1. Установка проекта в режиме разработки:
```
pip install -e .
```

2. Создание пакета:
```
python setup.py sdist bdist_wheel
```

3. Установка из созданного пакета:
```
pip install dist/QueueMateBot-*.whl
```

4. После установки бот можно запустить командой:
```
queuematebot
```

## Документация

Проект использует MkDocs для генерации документации из файлов Markdown.

### Установка зависимостей для документации

```bash
pip install -e .[docs]
```

или

```bash
pip install mkdocs mkdocs-material mkdocstrings mkdocstrings-python
```

### Сборка документации

Существует несколько способов сборки и просмотра документации:

1. Использование консольной команды (после установки пакета):
   ```bash
   # Сборка статической документации в директорию site/
   queuematebot-docs
   
   # Запуск сервера документации для разработки
   queuematebot-docs serve
   ```

2. Использование команды setup.py:
   ```bash
   python setup.py build_docs
   ```

3. Использование mkdocs напрямую:
   ```bash
   # Сборка документации
   mkdocs build
   
   # Запуск сервера разработки
   mkdocs serve
   
   # Публикация на GitHub Pages
   mkdocs gh-deploy
   ```

После сборки документации, статические HTML файлы будут доступны в директории `site/`. При запуске сервера разработки, документация будет доступна по адресу http://127.0.0.1:8000/.

## Команды бота

### Основные команды
- `/start` - начало работы с ботом
- `/help` - список доступных команд
- `/join [название]` - присоединиться к очереди
- `/exit [название]` - выйти из очереди
- `/rejoin [название]` - переместиться в конец очереди
- `/skip [название]` - пропустить одного человека вперед (переместиться на одну позицию назад)
- `/view` - показать список всех очередей в чате
- `/view [название]` - показать участников конкретной очереди
- `/setname [имя]` - установить своё отображаемое имя

### Команды администраторов
- `/create [название]` - создать новую очередь
- `/delete [название]` - удалить очередь полностью
- `/remove [название] [пользователь]` - удалить пользователя из очереди
- `/setposition [название] [пользователь] [позиция]` - изменить позицию пользователя в очереди

## Примеры использования

### Основные команды
- `/join Математика` - встать в очередь "Математика"
- `/exit Математика` - выйти из очереди "Математика"
- `/skip Математика` - пропустить одного человека вперед в очереди "Математика"
- `/view` - посмотреть все очереди
- `/view Математика` - посмотреть очередь "Математика"
- `/setname Иван` - установить имя "Иван"

### Команды администраторов
- `/create Математика` - создать очередь "Математика"
- `/delete Математика` - удалить очередь "Математика"
- `/remove Математика @username` - удалить пользователя с username из очереди
- `/remove Математика Иван` - удалить пользователя с именем "Иван" из очереди
- `/setposition Математика @username 1` - переместить пользователя на первую позицию
- `/setposition Математика Иван 3` - переместить пользователя на третью позицию

## Управление ботом через консоль

После запуска бота доступны следующие консольные команды:
- `stop`, `exit`, `quit` - остановить бота
- `status` - проверить статус бота
- `help` - показать список доступных команд

## Требования

- Python 3.7 или выше
- pyTelegramBotAPI 4.14.0
- python-dotenv 1.0.0

## Безопасность

- Токен бота хранится в файле `.env`, который не должен публиковаться в репозитории
- Добавьте `.env` в файл `.gitignore` для предотвращения случайной публикации
- Для продакшн-окружения рекомендуется использовать системные переменные окружения

## Логирование

Бот ведет логи в файл `bot.log`, который содержит информацию о:
- Запуске и остановке бота
- Выполненных командах
- Возникших ошибках
- Административных действиях