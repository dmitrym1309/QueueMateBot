# Архитектура бота

В этом разделе представлена архитектура QueueMateBot, описана структура проекта и взаимодействие основных компонентов.

## Обзор структуры проекта

Проект имеет следующую структуру файлов:

```
QueueMateBot/
├── main.py           # Точка входа, запускает бота
├── config.py         # Конфигурация бота и БД
├── database.py       # Работа с базой данных SQLite
├── handlers.py       # Обработчики команд бота
├── setup.py          # Конфигурация пакета для установки
├── MANIFEST.in       # Список нон-Python файлов для включения в пакет
├── requirements.txt  # Зависимости проекта
├── .env.example      # Пример файла переменных окружения
└── .env              # Переменные окружения (токен бота)
```

## Основные компоненты

### main.py

Основной файл проекта, который инициализирует логирование, базу данных и запускает бота. Он также регистрирует обработчик для корректного закрытия соединения с базой данных при завершении работы программы.

### config.py

Модуль конфигурации, который:
- Загружает переменные окружения из файла `.env`
- Содержит константы и настройки бота
- Определяет пути к БД и другим ресурсам

### database.py

Модуль для работы с базой данных SQLite:
- Создает таблицы при первом запуске
- Содержит функции для работы с очередями (создание, удаление, обновление)
- Управляет пользовательскими данными и их позициями в очередях

### handlers.py

Самый объемный модуль проекта, содержащий:
- Регистрацию обработчиков команд бота
- Обработчики всех пользовательских команд
- Бизнес-логику работы с очередями
- Формирование сообщений для пользователей

## Диаграмма взаимодействия компонентов

```
┌─────────────┐       ┌───────────┐       ┌────────────┐
│   main.py   │──────▶│ handlers.py│◀─────▶│ database.py│
└─────────────┘       └───────────┘       └────────────┘
      │                     │                    │
      │                     │                    │
      ▼                     ▼                    ▼
┌─────────────┐       ┌───────────┐       ┌────────────┐
│  config.py  │◀──────│  Telegram │       │  SQLite DB │
└─────────────┘       │    API    │       └────────────┘
                      └───────────┘
```

## Поток данных

1. Пользователь отправляет команду боту в Telegram
2. Telegram API передает сообщение боту
3. Обработчик в `handlers.py` получает сообщение
4. Обработчик вызывает соответствующие функции из `database.py` для работы с БД
5. Результат операции возвращается в обработчик
6. Обработчик формирует ответное сообщение и отправляет его пользователю через Telegram API

## Модель данных

В базе данных используются следующие основные таблицы:

1. **users** - информация о пользователях
2. **queues** - информация о созданных очередях
3. **queue_members** - связывает пользователей и очереди, содержит позиции

## Расширение функциональности

При расширении функциональности бота рекомендуется:

1. Добавлять новые функции для работы с БД в `database.py`
2. Создавать новые обработчики команд в `handlers.py`
3. При необходимости добавлять новые константы в `config.py`
4. Обновлять документацию при внесении значительных изменений 